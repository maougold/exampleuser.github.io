<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIRACLE SYSTEM V4.9+ AUTO RECOVERY</title>
    <style>
        body { background-color: #000; color: #fff; font-family: 'Hiragino Kaku Gothic Pro', 'Courier New', monospace; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; overflow: hidden; transition: background-color 1.5s, color 1.5s; }
        .main-layout { display: flex; gap: 40px; align-items: center; max-width: 1000px; padding: 20px; flex-wrap: wrap; justify-content: center; }
        
        #loader { text-align: center; }
        .spinner { width: 60px; height: 60px; border: 6px solid #333; border-top: 6px solid #ffcc00; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #game-container { display: none; text-align: center; flex: 1; min-width: 320px; }
        h1 { font-size: 1.8rem; color: #ffcc00; text-shadow: 0 0 15px #ffcc00; }
        
        #roulette-box { width: 300px; height: 80px; border: 5px solid #fff; position: relative; overflow: hidden; background: #111; margin: 25px auto; }
        #roulette-box::after { content: ""; position: absolute; top: 38px; left: 0; width: 100%; height: 4px; background: rgba(255, 255, 255, 0.8); pointer-events: none; z-index: 10; box-shadow: 0 0 10px #fff; }
        
        #roulette-list { position: absolute; top: 0; list-style: none; padding: 0; margin: 0; }
        .item { height: 80px; width: 300px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; border-bottom: 1px solid #333; box-sizing: border-box; }
        
        #spin-btn { padding: 18px 50px; font-size: 1.3rem; font-weight: bold; background: linear-gradient(45deg, #ffcc00, #ff6600); color: #fff; border: 3px solid #fff; border-radius: 60px; cursor: pointer; }
        #info-panel { background: rgba(255, 255, 255, 0.05); border-left: 4px solid #ffcc00; padding: 30px; text-align: left; min-width: 320px; display: none; border-radius: 15px; }
        #info-panel h3 { color: #ffcc00; margin-top: 0; border-bottom: 2px solid #ffcc00; text-align: center; }

        #result-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .miracle-bg { background-color: #ff0000; animation: flash 0.1s ease-in 3; }
        .doom-bg { background-color: #000; animation: doom-pulse 2s infinite; }
        @keyframes flash { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes doom-pulse { 0%, 100% { background-color: #000; } 50% { background-color: #2b0000; } }
        .win-text { font-size: 6rem; font-weight: 900; color: #fff; text-shadow: 6px 6px 0px #000; }
        .doom-text { color: #ff0000; text-shadow: 0 0 30px #ff0000; }
        
        #destroy-btn-final { padding: 25px 50px; background: #ff0000; color: #fff; border: 4px solid #fff; font-weight: bold; font-size: 1.8rem; cursor: pointer; margin-top: 30px; border-radius: 10px; box-shadow: 0 0 20px #ff0000; }

        @keyframes shake { 0% { transform: translate(0,0); } 10% { transform: translate(-5px, -5px); } 20% { transform: translate(5px, 5px); } 100% { transform: translate(0,0); } }
        .shaking { animation: shake 0.1s infinite; }
        .noise { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0px, rgba(255,255,255,0.05) 1px, transparent 1px, transparent 2px); pointer-events: none; opacity: 0; z-index: 200; }
        #message-box { display: none; font-size: 1.8rem; font-weight: bold; line-height: 2; z-index: 300; max-width: 80%; text-align: center;}
        .fade-out { transition: opacity 2s; opacity: 0; }
    </style>
</head>
<body id="body">

<div id="loader">
    <div class="spinner"></div>
    <div id="loading-text">SYSTEM BOOTING...</div>
</div>

<div class="main-layout" id="main-ui" style="display:none;">
    <div id="game-container">
        <h1>RECOVERY SYSTEM V4.9</h1>
        <div id="roulette-box">
            <ul id="roulette-list"></ul>
        </div>
        <button id="spin-btn" onclick="startRoulette()">奇跡を信じて回す</button>
    </div>
    <div id="info-panel">
        <h3>PROBABILITY: 50%</h3>
        <ul style="list-style: none; padding: 0;">
            <li><span style="color:#ffcc00;">●</span> 奇跡当選：Amazonへ転送</li>
            <li><span style="color:#ff4444;">●</span> 世界滅亡：システム破棄</li>
        </ul>
    </div> 
</div>

<div id="result-overlay">
    <h2 class="win-text" id="win-title">奇跡当選</h2>
    <p style="font-size: 2rem; font-weight: bold;" id="win-status">AUTHENTICATED</p>
    <p id="countdown" style="font-size: 1.5rem;">まもなく転送します...</p>
    <button id="destroy-btn-final" style="display:none;" onclick="startTheEnd()">世界を滅ぼす</button>
</div>

<div id="message-box"></div>
<div class="noise" id="noise"></div>

<script>
    let audioCtx;
    // 最初の操作（クリック）時にAudioContextを有効化するための関数
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    // 画面のどこをクリックしてもAudioが有効になるようにする
    document.addEventListener('click', initAudio, { once: true });

    function playSound(freq, type, duration, volume = 0.1) {
        if(!audioCtx || audioCtx.state === 'suspended') return; // 有効化されていなければ鳴らさない
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.value = freq;
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(volume, audioCtx.currentTime);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
        osc.stop(audioCtx.currentTime + duration);
    }

    const items = ["★奇跡当選★", "世界滅亡"];
    const listEl = document.getElementById('roulette-list');
    for(let i=0; i<100; i++) {
        const li = document.createElement('li');
        li.className = 'item';
        const text = items[i % items.length];
        li.innerText = text;
        li.style.color = text === "★奇跡当選★" ? "#ffcc00" : "#ff4444";
        listEl.appendChild(li);
    }

    // 自動で開始されるブート処理
    window.onload = function() {
        const loadingTexts = [
            "システムデータを構築中...", 
            "ユーザー権限を確認中...", 
            "サーバーの裏側を掃除中...", 
            "期待値を調整中...", 
            "ほぼ完了..."
        ];
        let ltIdx = 0;
        
        const ltInterval = setInterval(() => {
            if(ltIdx < loadingTexts.length) {
                document.getElementById('loading-text').innerText = loadingTexts[ltIdx++];
                // 注意: ここでplaySoundを呼んでも、クリック前ならブラウザにブロックされます
                playSound(440, 'square', 0.05, 0.05);
            } else {
                clearInterval(ltInterval);
                document.getElementById('loader').style.display = 'none';
                document.getElementById('main-ui').style.display = 'flex';
                document.getElementById('game-container').style.display = 'block';
                document.getElementById('info-panel').style.display = 'block';
                playSound(1000, 'sine', 0.4, 0.08);
            }
        }, 1000); 
    };

    function startRoulette() {
        initAudio(); // ボタンクリック時にも念のため初期化
        document.getElementById('spin-btn').style.visibility = 'hidden';
        const isMiracle = Math.random() < 0.5;
        const res = isMiracle 
            ? { type: "MIRACLE", url: "https://www.amazon.jp/hz/wishlist/ls/204FNL7FFUQPZ?ref_=wl_share", itemIdx: 0 }
            : { type: "DESTROY", url: "DESTROY", itemIdx: 1 };

        let count = 0;
        let pos = 0;
        
        const spinLoop = setInterval(() => {
            pos -= 80;
            listEl.style.top = pos + 'px';
            playSound(1200, 'sine', 0.02, 0.03); 
            
            count++;
            if (count > 30) {
                clearInterval(spinLoop);
                const targetSet = 40; 
                const finalPos = -( (targetSet * items.length * 80) + (res.itemIdx * 80) );
                
                listEl.style.transition = "top 3.5s cubic-bezier(0.15, 0, 0.15, 1)";
                listEl.style.top = finalPos + "px";

                for(let i=1; i<=10; i++) {
                    setTimeout(() => {
                        if(i < 10) playSound(1000 - (i*50), 'sine', 0.02, 0.02);
                    }, i * i * 35); 
                }
                
                setTimeout(() => showResult(res), 4000);
            }
        }, 60);
    }

    function showResult(res) {
        if(res.url === "DESTROY") {
            document.getElementById('main-ui').style.visibility = 'hidden';
            const overlay = document.getElementById('result-overlay');
            overlay.style.display = 'flex';
            overlay.classList.add('doom-bg');
            document.getElementById('win-title').innerText = "世界滅亡";
            document.getElementById('win-title').classList.add('doom-text');
            document.getElementById('win-status').innerText = "FATAL ERROR: SYSTEM TERMINATED";
            document.getElementById('countdown').style.display = 'none';
            document.getElementById('destroy-btn-final').style.display = 'block';
            playSound(50, 'sawtooth', 2, 0.3);
        } else {
            const overlay = document.getElementById('result-overlay');
            overlay.style.display = 'flex';
            overlay.classList.add('miracle-bg');
            [523, 659, 783, 1046].forEach((f, i) => {
                setTimeout(() => playSound(f, 'square', 0.6, 0.1), i * 150);
            });
            
            let sec = 3;
            const cd = setInterval(() => {
                sec--;
                document.getElementById('countdown').innerText = `Amazonへ転送中... 残り${sec}秒`;
                if(sec <= 0) { 
                    clearInterval(cd); 
                    window.location.href = res.url; 
                }
            }, 1000);
        }
    }

    function startTheEnd() {
        document.getElementById('result-overlay').style.display = 'none';
        const msgBox = document.getElementById('message-box');
        const body = document.getElementById('body');
        const noise = document.getElementById('noise');
        msgBox.style.display = 'block';

        playSound(60, 'sawtooth', 2, 0.5);
        body.classList.add('shaking');
        noise.style.opacity = 1;

        const sequences = [
            { t: "全システムアクセス権限を破棄...", d: 1500 },
            { t: "メモリを初期化中...", d: 1500 },
            { t: "さようなら、旧世界。", d: 2000 },
            { t: "……。", d: 2000 },
            { t: "（再起動待機中）", d: 2500 },
            { t: "システムを再構築します。", d: 2000 }
        ];

        let totalDelay = 0;
        sequences.forEach((item, index) => {
            setTimeout(() => {
                msgBox.innerText = item.t;
                playSound(200 + index * 40, 'sine', 0.1);
                if(index === 3) {
                    body.classList.remove('shaking');
                    noise.style.opacity = 0;
                    body.style.backgroundColor = "#fff";
                    body.style.color = "#000";
                }
            }, totalDelay);
            totalDelay += item.d;
        });

        setTimeout(() => {
            body.classList.add('fade-out');
            setTimeout(() => { location.reload(); }, 2000);
        }, totalDelay);
    }
</script>

</body>
</html>