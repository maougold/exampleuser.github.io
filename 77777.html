<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>NYANKO SLOT | COMPLETE EDITION</title>
    <style>
        body { 
            background: #fff0f5; color: #4a1c2a; font-family: 'Segoe UI', "Hiragino Sans", sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 100vh; margin: 0; overflow: hidden;
        }
        
        #game-layout { display: flex; gap: 40px; align-items: flex-start; padding: 20px; z-index: 10; }

        /* å·¦å´ï¼šé…å½“è¡¨ */
        #paytable {
            background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 20px;
            border: 2px solid #ffb3c6; font-size: 14px; box-shadow: 0 4px 15px rgba(201, 24, 74, 0.1);
        }
        #paytable h3 { margin: 0 0 15px 0; color: #c9184a; font-size: 18px; text-align: center; border-bottom: 2px solid #ffccd5; padding-bottom: 5px; }
        .pay-row { display: flex; justify-content: space-between; gap: 30px; border-bottom: 1px solid #ffe5ec; padding: 6px 0; }
        .pay-symbol { font-weight: bold; font-size: 16px; letter-spacing: 2px; }
        .pay-value { color: #c9184a; font-weight: bold; }

        /* ä¸­å¤®ï¼šãƒ¡ã‚¤ãƒ³ç­ä½“ */
        #main-cabinet { display: flex; flex-direction: column; align-items: center; }
        #money-bar { 
            background: #c9184a; color: #fff; padding: 12px 50px; border-radius: 50px; 
            font-size: 26px; font-weight: bold; margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(201, 24, 74, 0.3); border: 3px solid #fff; 
        }

        #slot-machine {
            background: #fff; padding: 30px; border: 8px solid #ff8fb1; border-radius: 40px;
            box-shadow: 0 15px 45px rgba(201, 24, 74, 0.2); position: relative; transition: 0.3s;
        }

        /* ãƒªãƒ¼ãƒæ¼”å‡ºï¼ˆèƒŒæ™¯æ˜æ»…ï¼‰ */
        .reach-mode { animation: reach-flash 0.4s infinite; }
        @keyframes reach-flash { 0% { background: #fff; } 50% { background: #ffd6e0; } 100% { background: #fff; } }

        #reels { display: flex; gap: 12px; background: #ffe5ec; padding: 20px; border-radius: 20px; margin-bottom: 25px; }
        .reel {
            width: 80px; height: 110px; background: #fff; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 45px; border: 2px solid #ffb3c6; transition: 0.1s;
        }
        
        /* å½“ãŸã‚Šæ™‚ã®ç™ºå…‰ */
        .win-glow { border-color: #ff4d6d !important; box-shadow: 0 0 25px #ff4d6d; transform: scale(1.1); background: #fff0f5 !important; }

        #spin-btn {
            width: 240px; padding: 18px; background: #ff4d6d; color: #fff;
            border: none; border-radius: 60px; font-size: 22px; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 0 #c9184a; transition: 0.1s;
        }
        #spin-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #c9184a; }
        #spin-btn:disabled { background: #ffb3c6; box-shadow: 0 4px 0 #ff8fb1; cursor: not-allowed; }

        #msg { height: 50px; margin-top: 20px; color: #c9184a; font-size: 20px; font-weight: bold; text-align: center; }

        /* ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆæ¼”å‡ºï¼šé™ã‚Šæ³¨ãã‚¢ã‚¤ãƒ†ãƒ  */
        .rain-item {
            position: fixed; top: -60px; font-size: 50px; user-select: none;
            pointer-events: none; z-index: 9999; animation: fall-and-spin 3s linear forwards;
        }
        @keyframes fall-and-spin {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            70% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="money-bar">ğŸ’° <span id="balance">1000</span> COINS</div>

<div id="game-layout">
    <div id="paytable">
        <h3>é…å½“è¡¨ (Payout)</h3>
        <div class="pay-row"><span class="pay-symbol">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span> <span class="pay-value">12000</span></div>
        <div class="pay-row"><span class="pay-symbol">â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span> <span class="pay-value">2500</span></div>
        <div class="pay-row"><span class="pay-symbol">ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±</span> <span class="pay-value">5000</span></div>
        <div class="pay-row"><span class="pay-symbol">ğŸ±ğŸ±ğŸ±ğŸ±</span> <span class="pay-value">1000</span></div>
        <div class="pay-row"><span class="pay-symbol">ğŸ±ğŸ±ğŸ±</span> <span class="pay-value">300</span></div>
        <div class="pay-row"><span class="pay-symbol">Other 5-Match</span> <span class="pay-value">2000</span></div>
        <div class="pay-row"><span class="pay-symbol">Other 4-Match</span> <span class="pay-value">500</span></div>
        <div class="pay-row"><span class="pay-symbol">Other 3-Match</span> <span class="pay-value">150</span></div>
        <p style="font-size: 11px; color: #999; margin-top: 15px; text-align: center;">1 SPIN = 100 COINS</p>
    </div>

    <div id="main-cabinet">
        <div id="slot-machine">
            <div id="reels">
                <div class="reel" id="reel1">ğŸ¾</div>
                <div class="reel" id="reel2">ğŸ¾</div>
                <div class="reel" id="reel3">ğŸ¾</div>
                <div class="reel" id="reel4">ğŸ¾</div>
                <div class="reel" id="reel5">ğŸ¾</div>
            </div>
            <div style="text-align: center;">
                <button id="spin-btn" onclick="spin()">SPIN START</button>
            </div>
        </div>
        <div id="msg"></div>
    </div>
</div>

<script>
    // é…å½“ãƒ‡ãƒ¼ã‚¿
    const PAYOUTS = {
        'â¤ï¸': { 3: 500, 4: 2500, 5: 12000 },
        'ğŸ±': { 3: 300, 4: 1000, 5: 5000 },
        'DEFAULT': { 3: 150, 4: 500, 5: 2000 }
    };
    const symbols = ['â¤ï¸', 'ğŸ±', 'ğŸˆ', 'ğŸŸ', 'ğŸ€', 'ğŸ’'];
    const reelEls = [1,2,3,4,5].map(i => document.getElementById(`reel${i}`));
    const balanceEl = document.getElementById('balance');
    const machine = document.getElementById('slot-machine');
    const msg = document.getElementById('msg');
    
    // ã‚¯ã‚¤ã‚ºãƒŸãƒªã‚ªãƒã‚¢ã¨å…±æœ‰ã•ã‚Œã‚‹æ®‹é«˜ï¼ˆlocalStorageï¼‰
    let balance = parseInt(localStorage.getItem('ev_coin_balance')) || 1000;
    balanceEl.innerText = balance.toLocaleString();

    function updateBalance(amount) {
        balance += amount;
        balanceEl.innerText = balance.toLocaleString();
        localStorage.setItem('ev_coin_balance', balance);
    }

    function spin() {
        if (balance < 100) { 
            msg.innerText = "ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ã«ã‚ƒï¼ã‚¯ã‚¤ã‚ºã§ç¨¼ãã«ã‚ƒï¼"; 
            return; 
        }
        updateBalance(-100);

        document.getElementById('spin-btn').disabled = true;
        msg.innerText = "ã¾ã‚ã‚‹ã«ã‚ƒã€œâ€¦";
        machine.classList.remove('reach-mode');
        reelEls.forEach(el => el.classList.remove('win-glow'));
        
        // å›è»¢é–‹å§‹
        const intervals = reelEls.map((el, i) => {
            return setInterval(() => {
                el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
            }, 60);
        });

        // é †æ¬¡åœæ­¢
        reelEls.forEach((el, i) => {
            let delay = 800 + (i * 500);
            setTimeout(() => {
                clearInterval(intervals[i]);
                // 4æšç›®åœæ­¢æ™‚ã«ãƒªãƒ¼ãƒåˆ¤å®š
                if (i === 3) handleReach(intervals[4]);
            }, delay);
        });
    }

    function handleReach(lastInterval) {
        const current = reelEls.slice(0, 4).map(e => e.innerText);
        const counts = {}; current.forEach(s => counts[s] = (counts[s] || 0) + 1);
        
        if (Math.max(...Object.values(counts)) >= 3) {
            machine.classList.add('reach-mode');
            msg.innerText = "ãƒ‰ã‚­ãƒ‰ã‚­â€¦ãƒªãƒ¼ãƒã ã«ã‚ƒï¼ï¼";
            clearInterval(lastInterval);
            // æœ€å¾Œã®ãƒªãƒ¼ãƒ«ã‚’ã‚¹ãƒ­ãƒ¼å›è»¢
            let lastReelTick = setInterval(() => {
                reelEls[4].innerText = symbols[Math.floor(Math.random() * symbols.length)];
            }, 200);
            setTimeout(() => { clearInterval(lastReelTick); checkWin(); }, 3500);
        } else {
            setTimeout(() => { clearInterval(lastInterval); checkWin(); }, 500);
        }
    }

    function checkWin() {
        document.getElementById('spin-btn').disabled = false;
        machine.classList.remove('reach-mode');
        const res = reelEls.map(el => el.innerText);
        const counts = {}; res.forEach(s => counts[s] = (counts[s] || 0) + 1);
        const maxCombo = Math.max(...Object.values(counts));
        const winSymbol = Object.keys(counts).find(key => counts[key] === maxCombo);

        if (maxCombo >= 3) {
            reelEls.forEach(el => { if (el.innerText === winSymbol) el.classList.add('win-glow'); });
            const prize = (PAYOUTS[winSymbol] || PAYOUTS['DEFAULT'])[maxCombo] || 0;
            
            if (prize > 0) {
                msg.innerText = `âœ¨ ${maxCombo}ã¤æƒã£ãŸï¼ ${prize}ã‚³ã‚¤ãƒ³ç²å¾—ï¼ âœ¨`;
                updateBalance(prize);
                
                // 5ã¤æƒã„ã®ã‚¹ãƒšã‚·ãƒ£ãƒ«æ¼”å‡º
                if (maxCombo === 5) {
                    if (winSymbol === 'â¤ï¸') {
                        msg.innerText = "â¤ï¸ PERFECT HEART! 12000æšç²å¾—ï¼ï¼ â¤ï¸";
                        launchJackpotRain('â¤ï¸');
                    } else if (winSymbol === 'ğŸ±') {
                        msg.innerText = "ğŸ¾ ã«ã‚ƒã‚“ã“ JACKPOT! 5000æšç²å¾—ï¼ï¼ ğŸ¾";
                        launchJackpotRain('ğŸ±');
                    } else {
                        launchJackpotRain('âœ¨');
                    }
                }
            }
        } else {
            msg.innerText = "æ®‹å¿µâ€¦ã¾ãŸã¯ãšã‚ŒãŸã«ã‚ƒã€‚";
        }
    }

    // ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆãƒ»ãƒ¬ã‚¤ãƒ³æ¼”å‡º
    function launchJackpotRain(symbol) {
        const count = 100;
        for (let i = 0; i < count; i++) {
            setTimeout(() => {
                const item = document.createElement('div');
                item.className = 'rain-item';
                item.innerText = symbol;
                item.style.left = Math.random() * 100 + 'vw';
                item.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(item);
                setTimeout(() => item.remove(), 3000);
            }, i * 25);
        }
    }
</script>
</body>
</html>