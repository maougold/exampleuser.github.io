<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>MILLIONAIRE PROTOCOL | ULTIMATE</title>
    <style>
        body {
            background: radial-gradient(circle, #000044 0%, #000000 100%);
            color: #fff;
            font-family: "Helvetica Neue", Arial, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            display: flex;
            width: 95%;
            max-width: 1100px;
            gap: 30px;
            align-items: flex-end;
        }

        #main-area { flex: 3; display: flex; flex-direction: column; align-items: center; }
        #menu-screen, #game-ui, #success-screen { display: none; width: 100%; text-align: center; }

        .menu-btn {
            display: block; width: 100%; margin: 15px 0; padding: 20px;
            font-size: 20px; font-weight: bold; border-radius: 40px;
            cursor: pointer; transition: 0.3s; background: #000; border: 2px solid #444; color: #fff;
        }
        .menu-btn:hover { background: #ff9900; color: #000; border-color: #fff; }

        #question-box {
            width: 100%; padding: 40px; margin-bottom: 30px; font-size: 22px; line-height: 1.6;
            background: linear-gradient(180deg, #000033 0%, #000099 50%, #000033 100%);
            border: 2px solid #999; border-radius: 60px / 120px; box-sizing: border-box;
        }

        .answer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; }
        .answer-btn {
            background: #000; border: 2px solid #666; border-radius: 40px; padding: 15px 25px;
            color: #fff; font-size: 18px; text-align: left; cursor: pointer; transition: 0.2s;
        }
        .answer-btn:hover:not(.hidden-opt) { background: #ff9900; color: #000; border-color: #fff; }
        .label { color: #ff9900; font-weight: bold; margin-right: 15px; }
        .hidden-opt { visibility: hidden; pointer-events: none; }

        #sidebar {
            flex: 1;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #444;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }

        .money-step {
            display: flex; justify-content: space-between; padding: 5px 15px;
            font-family: 'Courier New', monospace; color: #ff9900; font-size: 16px;
            border-radius: 10px; margin-bottom: 2px;
        }
        .current-step { background: #ff9900; color: #000; font-weight: bold; box-shadow: 0 0 15px #ff9900; }
        .passed-step { color: #fff; opacity: 0.4; }

        .lifeline-area { display: flex; justify-content: space-around; margin-bottom: 25px; }
        .lifeline-btn {
            width: 70px; height: 45px; border-radius: 50%; border: 2px solid #fff;
            background: radial-gradient(circle, #000066, #000); color: #fff;
            font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .lifeline-btn:hover:not(.used) { background: #fff; color: #000; }
        .lifeline-btn.used { opacity: 0.2; cursor: default; text-decoration: line-through; }

        #walk-away-btn {
            margin-top: 30px; background: #300; color: #f66; border: 1px solid #600;
            padding: 10px 25px; border-radius: 20px; cursor: pointer; font-size: 14px;
        }
        #walk-away-btn:hover { background: #600; color: #fff; }

        .rocket-trigger { font-size: 100px; cursor: pointer; position: relative; display: inline-block; }
        .rocket-anim { position: absolute; bottom: 0; left: 0; opacity: 0; transform: rotate(45deg); font-size: 70px; }
        .launch .rocket-anim { animation: launchDiagonal 1.8s ease-in forwards; }
        @keyframes launchDiagonal {
            0% { transform: translate(0,0) rotate(45deg); opacity: 1; }
            100% { transform: translate(1000px, -1000px) rotate(45deg); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="main-area">
        <div id="menu-screen" style="display: block;">
            <h1 style="color: #ff9900; text-shadow: 0 0 15px #ff9900;">AUTHENTICATION SELECT</h1>
            <button class="menu-btn" onclick="startGame('EASY')">EASY [å¼•ã£ã‹ã‘ãƒ»ç›´æ„Ÿ]</button>
            <button class="menu-btn" onclick="startGame('NORMAL')">NORMAL [ç”Ÿæ´»é›‘å­¦ãƒ»çŸ¥æµ]</button>
            <button class="menu-btn" onclick="startGame('HARD')">HARD [å›½éš›æƒ…å‹¢ãƒ»åœ°æ”¿å­¦]</button>
        </div>

        <div id="game-ui">
            <div id="question-box">ã“ã“ã«å•é¡Œæ–‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            <div class="answer-grid">
                <button class="answer-btn" id="btn-A" onclick="checkAnswer('A')"><span class="label">A:</span> <span id="opt-A"></span></button>
                <button class="answer-btn" id="btn-B" onclick="checkAnswer('B')"><span class="label">B:</span> <span id="opt-B"></span></button>
                <button class="answer-btn" id="btn-C" onclick="checkAnswer('C')"><span class="label">C:</span> <span id="opt-C"></span></button>
                <button class="answer-btn" id="btn-D" onclick="checkAnswer('D')"><span class="label">D:</span> <span id="opt-D"></span></button>
            </div>
            <button id="walk-away-btn" onclick="walkAway()">ã“ã“ã§è¾ã‚ã‚‹ (è³é‡‘ã‚’ç¢ºå®š)</button>
        </div>

        <div id="success-screen">
            <h1 id="success-title" style="color: #ff9900; font-size: 40px;">MISSION COMPLETE</h1>
            <div class="rocket-trigger" id="finalBtn">
                <span id="heart-icon" style="color: #f00;">â¤</span>
                <span class="rocket-anim">ğŸš€</span>
            </div>
            <p id="reward-display">çœŸå®ŸãŒæ‹¡æ•£ã•ã‚Œã¾ã—ãŸã€‚</p>
        </div>
    </div>

    <div id="sidebar">
        <div class="lifeline-area">
            <button id="fifty-fifty" class="lifeline-btn" onclick="useFiftyFifty()">50:50</button>
            <button id="phone" class="lifeline-btn" onclick="usePhone()">ğŸ“</button>
            <button id="audience" class="lifeline-btn" onclick="useAudience()">ğŸ“Š</button>
        </div>
        <div id="audience-chart" style="display:none; margin-bottom:10px; background:#111; padding:10px; border:1px solid #ff9900; font-size:10px;"></div>
        <div id="money-ladder"></div>
    </div>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playFreq(f, d, v=0.1) {
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.frequency.value = f; g.gain.value = v;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

const moneyList = ["10,000", "20,000", "30,000", "50,000", "100,000", "250,000", "500,000", "1,000,000", "2,500,000", "10,000,000"];

const quizData = {
    EASY: [
        { q: "ãƒªãƒ³ã‚´ãŒ3ã¤ã‚ã‚Šã¾ã—ãŸã€‚ãã“ã‹ã‚‰2ã¤å–ã£ãŸã‚‰ã€ã‚ãªãŸã®æ‰‹å…ƒã«ã¯ãƒªãƒ³ã‚´ã¯ä½•å€‹ã‚ã‚‹ï¼Ÿ", a: "1å€‹", b: "2å€‹", c: "3å€‹", d: "0å€‹", ans: "B" },
        { q: "1å¹´ã®ä¸­ã§ã€Œ28æ—¥ã€ãŒã‚ã‚‹æœˆã¯ã„ãã¤ã‚ã‚‹ï¼Ÿ", a: "1ã¤", b: "ã†ã‚‹ã†å¹´ã ã‘", c: "12å€‹ã™ã¹ã¦", d: "0å€‹", ans: "C" },
        { q: "æ—¥æœ¬ã®ã€Œ50å††ç¡¬è²¨ã€ã«æã‹ã‚Œã¦ã„ã‚‹èŠ±ã®ç¨®é¡ã¯ï¼Ÿ", a: "æ¡œ", b: "èŠ", c: "æ¢…", d: "ãƒ‘ãƒ³ã‚¸ãƒ¼", ans: "B" },
        { q: "è–å¾³å¤ªå­ãŒç”Ÿãã¦ã„ãŸé ƒã€æœ¬äººã¯å‘¨ã‚Šã‹ã‚‰ä½•ã¨å‘¼ã°ã‚Œã¦ã„ãŸï¼Ÿ", a: "å©æˆ¸çš‡å­", b: "è–å¾³ã•ã‚“", c: "åä¸ƒæ¡ã®æ†²æ³•", d: "ãŠæœ­ã®äºº", ans: "A" },
        { q: "ä¸€éšå»ºã¦ã®ã€Œé’ã„å®¶ã€ãŒã‚ã‚Šã¾ã™ã€‚å®¶å…·ã‚‚å£ã‚‚ã™ã¹ã¦é’ã€‚ã•ã¦ã€éšæ®µã¯ä½•è‰²ï¼Ÿ", a: "é’è‰²", b: "ç™½è‰²", c: "é€æ˜", d: "éšæ®µã¯ãªã„", ans: "D" },
        { q: "æ—¥æœ¬ã§ä¸€ç•ªã€Œå—ã€ã«ã‚ã‚‹éƒ½é“åºœçœŒã¯ã©ã“ï¼Ÿ", a: "é¹¿å…å³¶çœŒ", b: "æ²–ç¸„çœŒ", c: "æ±äº¬éƒ½", d: "é«˜çŸ¥çœŒ", ans: "C" },
        { q: "ã€Œ1ã‚¢ã‚¦ãƒˆã€ãƒ©ãƒ³ãƒŠãƒ¼æº€å¡ã€ã€‚ãƒãƒƒã‚¿ãƒ¼ãŒãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ã‚’æ‰“ã£ãŸã‚‰ã€ä½•ç‚¹å…¥ã‚‹ï¼Ÿ", a: "3ç‚¹", b: "4ç‚¹", c: "1ç‚¹", d: "0ç‚¹", ans: "B" },
        { q: "ãƒ¬ãƒ¼ã‚¹ã§ã€Œ2ä½ã®äººã€ã‚’è¿½ã„è¶Šã—ã¾ã—ãŸã€‚ã‚ãªãŸã®é †ä½ã¯ä½•ä½ï¼Ÿ", a: "1ä½", b: "2ä½", c: "3ä½", d: "ãƒªã‚¿ã‚¤ã‚¢", ans: "B" },
        { q: "ã‚¨ãƒ™ãƒ¬ã‚¹ãƒˆãŒç™ºè¦‹ã•ã‚Œã‚‹å‰ã€ä¸–ç•Œã§ä¸€ç•ªé«˜ã‹ã£ãŸå±±ã¯ä½•ï¼Ÿ", a: "å¯Œå£«å±±", b: "K2", c: "ã‚­ãƒªãƒãƒ³ã‚¸ãƒ£ãƒ­", d: "ã‚¨ãƒ™ãƒ¬ã‚¹ãƒˆ", ans: "D" },
        { q: "ã“ã®ã‚¯ã‚¤ã‚ºã®ã€Œç¬¬1å•ã€ã®æ­£è§£ã®æ•°å­—ã¯ä½•ã ã£ãŸï¼Ÿ", a: "1", b: "2", c: "3", d: "0", ans: "B" }
    ],
    NORMAL: [
        { q: "é£Ÿãƒ‘ãƒ³ã®è¢‹ã‚’ç•™ã‚ã¦ã„ã‚‹ã€Œã‚ã®ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®ç•™ã‚å…·ã€ã€‚æ­£å¼åç§°ã¯ï¼Ÿ", a: "ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼", b: "ã‚¯ã‚¤ãƒƒã‚¯ãƒ»ãƒ­ãƒƒã‚¯", c: "ãƒãƒƒã‚°ãƒ»ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼", d: "ãƒ‘ãƒ³ãƒ»ã‚¯ãƒªãƒƒãƒ—", ans: "C" },
        { q: "ã‹ãæ°·ã‚·ãƒ­ãƒƒãƒ—ã®ã‚¤ãƒã‚´ã€ãƒ¡ãƒ­ãƒ³ã€ãƒ–ãƒ«ãƒ¼ãƒãƒ¯ã‚¤ã€‚å‘³ã®ãƒ™ãƒ¼ã‚¹ä»¥å¤–ã§å”¯ä¸€é•ã†ã®ã¯ï¼Ÿ", a: "ç³–åˆ†ã®é‡", b: "é…¸å‘³ã®æˆåˆ†", c: "è‰²ã¨é¦™æ–™", d: "æ°·ã®å‰Šã‚Šæ–¹", ans: "C" },
        { q: "æ˜æ²»æ™‚ä»£ã€æœ€åˆã«å°å…¥ã•ã‚ŒãŸæ™‚ã®ã€Œéƒµä¾¿ãƒã‚¹ãƒˆã€ã®è‰²ã¯ä½•è‰²ã ã£ãŸï¼Ÿ", a: "é»’è‰²", b: "ç™½è‰²", c: "é’è‰²", d: "é‡‘è‰²", ans: "A" },
        { q: "æ•‘æ€¥è»Šã®ã‚µã‚¤ãƒ¬ãƒ³ã€Œãƒ”ãƒ¼ãƒãƒ¼ã€ã€‚ãƒ”ãƒ¼ã¨ãƒãƒ¼ã§ç‰©ç†çš„ã«é•ã†ã®ã¯ï¼Ÿ", a: "éŸ³é‡", b: "å‘¨æ³¢æ•°(éŸ³ã®é«˜ã•)", c: "éŸ³ã®æ³¢é•·", d: "ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®æ•°", ans: "B" },
        { q: "ãƒ¬ãƒˆãƒ«ãƒˆã‚«ãƒ¬ãƒ¼ã®ã€Œãƒ¬ãƒˆãƒ«ãƒˆã€ã¨ã¯ã€ã‚ªãƒ©ãƒ³ãƒ€èªã§ã©ã†ã„ã†æ„å‘³ï¼Ÿ", a: "ä¿å­˜é£Ÿ", b: "è’¸æ°—èª¿ç†", c: "åŠ åœ§åŠ ç†±æ®ºèŒé‡œ", d: "é­”æ³•ã®è¢‹", ans: "C" },
        { q: "ãƒˆãƒ©ãƒ³ãƒ—ã®4äººã®ã‚­ãƒ³ã‚°ã®ä¸­ã§ã€1äººã ã‘ã€Œå£ã²ã’ã€ãŒãªã„ã®ã¯ï¼Ÿ", a: "ã‚¹ãƒšãƒ¼ãƒ‰", b: "ãƒãƒ¼ãƒˆ", c: "ãƒ€ã‚¤ãƒ¤", d: "ã‚¯ãƒ©ãƒ–", ans: "B" },
        { q: "æ—¥æœ¬ã§æœ€ã‚‚æ™®åŠã—ã€å£²ã‚Œã¦ã„ã‚‹ã€Œä¹¾é›»æ± ã€ã®ã‚µã‚¤ã‚ºã¯ï¼Ÿ", a: "å˜1å½¢", b: "å˜2å½¢", c: "å˜3å½¢", d: "å˜4å½¢", ans: "C" },
        { q: "éå¸¸å£ãƒãƒ¼ã‚¯ã®ã€Œèµ°ã£ã¦ã„ã‚‹äººã€ã€‚ã“ã®ãƒ”ã‚¯ãƒˆã‚°ãƒ©ãƒ ã®å…¬å¼æ„›ç§°ã¯ï¼Ÿ", a: "ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãã‚“", b: "ãƒ”ã‚¯ãƒˆã•ã‚“", c: "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ãƒãƒ³", d: "åå‰ã¯ãªã„", ans: "B" },
        { q: "ä¸€èˆ¬çš„ãªéŠ€è¡ŒATM1å°ã®ä¸­ã«ã€æœ€å¤§ã§ã„ãã‚‰ã¾ã§ç¾é‡‘ãŒå…¥ã‚‹ï¼Ÿ", a: "1000ä¸‡å††", b: "3000ä¸‡å††", c: "1å„„å††", d: "5å„„å††", ans: "C" },
        { q: "ã‚†ã§åµã‚’ç¶ºéº—ã«ã‚€ãã«ã¯ã€èŒ¹ã§ã‚‹ç›´å‰ã«åµã®ã©ã“ã«ç©´ã‚’é–‹ã‘ã‚‹ã®ãŒæ­£è§£ï¼Ÿ", a: "å°–ã£ã¦ã„ã‚‹æ–¹", b: "å´é¢", c: "ä¸¸ã„æ–¹", d: "ã©ã“ã§ã‚‚ã„ã„", ans: "C" }
    ],
    HARD: [
        { q: "å†·æˆ¦å¾Œã€NATOãŒæ­´å²ä¸Šã§åˆã‚ã¦ã€Œé›†å›£è‡ªè¡›æ¨©(ç¬¬5æ¡)ã€ã‚’ç™ºå‹•ã—ãŸå¥‘è¨˜ã¯ï¼Ÿ", a: "ã‚¤ãƒ©ã‚¯æˆ¦äº‰", b: "ã‚¢ãƒ•ã‚¬ãƒ³ä¾µæ”»", c: "9.11ç±³åŒæ™‚å¤šç™ºãƒ†ãƒ­", d: "ã‚³ã‚½ãƒœç´›äº‰", ans: "C" },
        { q: "å›½é€£å®‰ä¿ç†å¸¸ä»»ç†äº‹å›½ã®ä¸­ã§ã€ä¸€åº¦ã‚‚æ‹’å¦æ¨©ã‚’è¡Œä½¿ã—ã¦ã„ãªã„å›½ã¯ï¼Ÿ", a: "ãƒ•ãƒ©ãƒ³ã‚¹", b: "ä¸­å›½", c: "ã‚¤ã‚®ãƒªã‚¹", d: "å­˜åœ¨ã—ãªã„", ans: "D" },
        { q: "EUæ³•ãŒåŠ ç›Ÿå›½ã®å›½å†…æ³•ã«å¯¾ã—ã¦å„ªå…ˆã•ã‚Œã‚‹åŸå‰‡ã‚’ç¢ºç«‹ã—ãŸæ­´å²çš„åˆ¤æ±ºã¯ï¼Ÿ", a: "ã‚³ã‚¹ã‚¿å¯¾ENELåˆ¤æ±º", b: "ãƒªã‚¹ãƒœãƒ³æ¡ç´„åˆ¤æ±º", c: "ãƒãƒ¼ã‚¹ãƒˆãƒªãƒ’ãƒˆåˆ¤æ±º", d: "ãƒ‘ãƒªæ¡ç´„åˆ¤æ±º", ans: "A" },
        { q: "å›½å®¶æ‰¿èªã¯ãªã„ãŒå®Ÿè³ªçš„å›½å®¶æ©Ÿèƒ½ã‚’æŒã¡ã‚¤ã‚¹ãƒ©ã‚¨ãƒ«ã¨å¯¾å³™ã™ã‚‹ä¸»ä½“ã¨ãã®å¾Œã‚ç›¾ã¯ï¼Ÿ", a: "ã‚¿ãƒªãƒãƒ³ï¼‹ä¸­å›½", b: "ãƒãƒã‚¹ï¼‹ã‚¤ãƒ©ãƒ³", c: "ãƒ•ãƒ¼ã‚·æ´¾ï¼‹ãƒ­ã‚·ã‚¢", d: "ã‚¯ãƒ«ãƒ‰ï¼‹ã‚¢ãƒ¡ãƒªã‚«", ans: "B" },
        { q: "2020å¹´ãƒ­ã‚·ã‚¢æ†²æ³•æ”¹æ­£ã«ãŠã„ã¦ãƒ—ãƒ¼ãƒãƒ³æ”¿æ¨©ãŒå¾—ãŸæœ€å¤§ã®å®Ÿè³ªçš„åŠ¹æœã¯ï¼Ÿ", a: "ä¸Šä¸‹é™¢å»ƒæ­¢", b: "ä»»æœŸãƒªã‚»ãƒƒãƒˆã«ã‚ˆã‚‹é•·æœŸæ”¿æ¨©åˆæ³•åŒ–", c: "ç›´æ¥é¸æŒ™å»ƒæ­¢", d: "æ ¸ä½¿ç”¨æ¨©ã®æ‹¡å¤§", ans: "B" },
        { q: "ç±³å¤§çµ±é ˜é¸ã§ã€å‹åˆ©ãŒæ³•çš„ã«ç¢ºå®šã™ã‚‹æœ€ã‚‚é‡è¦ãªã€Œç¢ºå®šæ—¥ã€ã¯ï¼Ÿ", a: "11æœˆã®ä¸€èˆ¬æŠ•ç¥¨æ—¥", b: "12æœˆã®é¸æŒ™äººå›£æŠ•ç¥¨æ—¥", c: "1æœˆã®å°±ä»»å¼", d: "äºˆå‚™é¸çµ‚äº†æ—¥", ans: "B" },
        { q: "ä¸­å›½å…±ç”£å…šæ–‡æ›¸ã§ä½¿ã‚ã‚Œã‚‹ã€Œæ ¸å¿ƒ(ã‚³ã‚¢)ã€ã¨ã„ã†è¨€è‘‰ã®å®Ÿè³ªçš„æ„å‘³ã¯ï¼Ÿ", a: "æœ€å¤§æ´¾é–¥ä»£è¡¨è€…", b: "å½¢å¼çš„è±¡å¾´", c: "æœ€çµ‚è£å®šæ¨©ã‚’æŒã¤ä¸å¯ä¾µã®æŒ‡å°çš„åœ°ä½", d: "è»äº‹äº‹å‹™è²¬ä»»è€…", ans: "C" },
        { q: "è¿‘å¹´ã®ã‚¢ãƒ•ãƒªã‚«ã§ã®ã‚¯ãƒ¼ãƒ‡ã‚¿ãƒ¼ã«å…±é€šã™ã‚‹å¯¾å¤–é–¢ä¿‚ã®å¤‰åŒ–ã¯ï¼Ÿ", a: "è‹±é›¢è„±ï¼‹ä¸­æ¥è¿‘", b: "ä»é›¢è„±ï¼‹éœ²æ¥è¿‘", c: "ç±³é›¢è„±ï¼‹ã‚¤ãƒ©ãƒ³æ¥è¿‘", d: "EUé›¢è„±ï¼‹ãƒˆãƒ«ã‚³æ¥è¿‘", ans: "B" },
        { q: "ã‚¤ã‚¹ãƒ©ã‚¨ãƒ«ãŒç¾åœ¨ã‚‚ã€Œæˆæ–‡æ†²æ³•ã€ã‚’æŒãŸãªã„æœ€å¤§ã®æ”¿æ²»çš„ç†ç”±ã¯ï¼Ÿ", a: "ä¸–ä¿—æ´¾ã¨å®—æ•™æ´¾ã®å¯¾ç«‹", b: "å»ºå›½æ™‚ã®æ™‚é–“ä¸è¶³", c: "ã‚¤ã‚®ãƒªã‚¹ã®ç¦æ­¢", d: "å›½é€£ã®è¦è«‹", ans: "A" },
        { q: "å›½å®¶ä¸»æ¨©ã¨äººæ¨©ä»‹å…¥ãŒè¡çªã™ã‚‹éš›ã«æ²ã’ã‚‰ã‚Œã‚‹è±¡å¾´çš„åŸå‰‡ã¯ï¼Ÿ", a: "é›†å›£è‡ªè¡›æ¨©", b: "æ°‘æ—è‡ªæ±º", c: "å‹¢åŠ›å‡è¡¡", d: "è²¬ä»»ã‚ã‚‹ä¿è­·(R2P)", ans: "D" }
    ]
};

let currentLevel = '';
let currentStep = 0;
let fiftyUsed = false;
let phoneUsed = false;
let audienceUsed = false;

function startGame(lv) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    currentLevel = lv;
    currentStep = 0;
    fiftyUsed = false;
    phoneUsed = false;
    audienceUsed = false;
    document.getElementById('fifty-fifty').classList.remove('used');
    document.getElementById('phone').classList.remove('used');
    document.getElementById('audience').classList.remove('used');
    document.getElementById('audience-chart').style.display = 'none';
    document.getElementById('menu-screen').style.display = 'none';
    document.getElementById('game-ui').style.display = 'block';
    initLadder();
    updateView();
}

function initLadder() {
    const ladder = document.getElementById('money-ladder');
    ladder.innerHTML = '';
    for (let i = moneyList.length - 1; i >= 0; i--) {
        const div = document.createElement('div');
        div.id = `step-${i}`;
        div.className = 'money-step';
        div.innerHTML = `<span>${i + 1}</span> <span>Â¥${moneyList[i]}</span>`;
        ladder.appendChild(div);
    }
}

function updateView() {
    if (currentStep >= 10) {
        showResult(moneyList[9]);
        return;
    }
    for (let i = 0; i < 10; i++) {
        const el = document.getElementById(`step-${i}`);
        el.className = 'money-step';
        if (i === currentStep) el.classList.add('current-step');
        else if (i < currentStep) el.classList.add('passed-step');
    }

    const data = quizData[currentLevel][currentStep];
    document.getElementById('question-box').innerText = data.q;
    const btnIds = ['btn-A', 'btn-B', 'btn-C', 'btn-D'];
    const opts = ['a', 'b', 'c', 'd'];
    
    btnIds.forEach((id, idx) => {
        const btn = document.getElementById(id);
        btn.classList.remove('hidden-opt');
        document.getElementById('opt-' + (id.split('-')[1])).innerText = data[opts[idx]];
    });
}

function checkAnswer(pick) {
    playFreq(440, 0.1);
    if (confirm("ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ã‚¢ãƒ³ã‚µãƒ¼ï¼Ÿ")) {
        if (pick === quizData[currentLevel][currentStep].ans) {
            playFreq(880, 0.4);
            alert("æ­£è§£ï¼");
            currentStep++;
            updateView();
        } else {
            playFreq(110, 0.8);
            alert("ä¸æ­£è§£... æ¨©é™ã‚’å¤±ã„ã¾ã—ãŸã€‚");
            location.reload();
        }
    }
}

function useFiftyFifty() {
    if (fiftyUsed || currentStep >= 10) return;
    fiftyUsed = true;
    document.getElementById('fifty-fifty').classList.add('used');
    const correct = quizData[currentLevel][currentStep].ans;
    const options = ['A', 'B', 'C', 'D'].filter(opt => opt !== correct);
    for (let i = 0; i < 2; i++) {
        const idx = Math.floor(Math.random() * options.length);
        const target = options.splice(idx, 1)[0];
        document.getElementById(`btn-${target}`).classList.add('hidden-opt');
    }
}

function usePhone() {
    if (phoneUsed || currentStep >= 10) return;
    phoneUsed = true;
    document.getElementById('phone').classList.add('used');
    const correct = quizData[currentLevel][currentStep].ans;
    alert(`ã€TELEPHONE é€šä¿¡ç¢ºç«‹ã€‘\n\nã€Œâ€¦å½“å±€ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚Œã°ã€ç­”ãˆã¯ ${correct} ã ã€‚ä¿¡ã˜ã¦ãã‚Œã€‚ã€`);
}

function useAudience() {
    if (audienceUsed || currentStep >= 10) return;
    audienceUsed = true;
    document.getElementById('audience').classList.add('used');
    const correct = quizData[currentLevel][currentStep].ans;
    const chart = document.getElementById('audience-chart');
    chart.style.display = 'block';
    let rates = { A: 10, B: 10, C: 10, D: 10 };
    rates[correct] = 60 + Math.floor(Math.random() * 15);
    let html = '<div style="color:#ff9900; margin-bottom:5px;">AUDIENCE POLL:</div>';
    ['A', 'B', 'C', 'D'].forEach(opt => {
        html += `<div style="display:flex; align-items:center; margin:2px 0;">
                    <span style="width:15px;">${opt}:</span>
                    <div style="background:#ff9900; height:8px; width:${rates[opt]}px; margin:0 5px;"></div>
                    <span>${rates[opt]}%</span>
                 </div>`;
    });
    chart.innerHTML = html;
}

function walkAway() {
    if (currentStep === 0) { alert("ã¾ã å®Ÿç¸¾ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"); return; }
    const prize = moneyList[currentStep - 1];
    if (confirm(`ç¾åœ¨ã®å®Ÿç¸¾ Â¥${prize} ã‚’ç¢ºå®šã•ã›ã¦è¾ã‚ã¾ã™ã‹ï¼Ÿ`)) {
        showResult(prize);
    }
}

/* --- ã‚¹ãƒ­ãƒƒãƒˆé€£æºæ©Ÿèƒ½ --- */
function syncPrizeToSlot(prizeStr) {
    // 10,000 ãªã©ã®æ–‡å­—åˆ—ã‚’æ•°å€¤ã«å¤‰æ›
    const prizeAmount = parseInt(prizeStr.replace(/,/g, ''));
    let currentBalance = parseInt(localStorage.getItem('ev_coin_balance')) || 1000;
    const newBalance = currentBalance + prizeAmount;
    localStorage.setItem('ev_coin_balance', newBalance);
}

function showResult(amount) {
    document.getElementById('game-ui').style.display = 'none';
    const res = document.getElementById('success-screen');
    res.style.display = 'block';
    
    // ã‚¹ãƒ­ãƒƒãƒˆã¸é€é‡‘
    syncPrizeToSlot(amount);
    
    document.getElementById('reward-display').innerText = `ç²å¾—å®Ÿç¸¾: Â¥${amount} ï¼ ã‚¹ãƒ­ãƒƒãƒˆã®æ®‹é«˜ã«è»¢é€ã•ã‚Œã¾ã—ãŸã€‚`;
    if (currentLevel === 'HARD') {
        document.getElementById('success-title').innerText = "â˜… GOLDEN INTEL MASTER â˜…";
        document.getElementById('success-title').style.color = "#ffd700";
    }
}

document.getElementById('finalBtn').onclick = function() {
    this.classList.add('launch');
    playFreq(200, 1.5, 0.3);
    setTimeout(() => {
        alert("ğŸ›° æ‹¡æ•£å®Œäº†ã€‚");
        window.location.href = "index.html";
    }, 2000);
};
</script>
</body>
</html>
