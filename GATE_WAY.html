<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NYANKO GATE: VALENTINE MASTERPIECE</title>
    <style>
        :root { --main-pink: #ff4d94; --bg-red: #4d0019; --gold: #ffd700; --heart-color: rgba(255, 77, 148, 0.3); }
        
        body { 
            background: linear-gradient(135deg, #2b0000, var(--bg-red), #2b0000); 
            color: #fff; font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; 
            display: flex; align-items: center; justify-content: center; 
            height: 100vh; margin: 0; overflow: hidden; position: relative;
        }

        body::before {
            content: "â™¥"; position: absolute; color: var(--heart-color);
            font-size: 20px; animation: floatingHeart 10s linear infinite;
            text-shadow: 40vw 10vh 0, 80vw 50vh 0, 10vw 80vh 0, 60vw 90vh 0, 30vw 30vh 0; z-index: -1;
        }
        @keyframes floatingHeart {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        #terminal { 
            width: 90%; max-width: 500px; padding: 25px; border: 6px solid var(--main-pink); 
            background: rgba(43, 0, 0, 0.85); border-radius: 40px; 
            box-shadow: 0 0 40px rgba(255, 77, 148, 0.5); position: relative; text-align: center; backdrop-filter: blur(5px);
            transition: all 0.5s ease;
        }
        
        .final-warning-mode { animation: final-pulse 0.5s infinite alternate !important; border-color: #ff0000 !important; }
        @keyframes final-pulse { from { box-shadow: 0 0 20px #ff0000; } to { box-shadow: 0 0 50px #ff0000; } }

        #progress-bar { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .step { 
            width: 30px; height: 30px; border-radius: 50%; background: rgba(0,0,0,0.4); 
            display: flex; align-items: center; justify-content: center; font-size: 14px; color: #555;
        }
        .step.active { background: var(--main-pink); color: #fff; box-shadow: 0 0 15px var(--main-pink); }
        .step.current { background: #fff; color: var(--main-pink); transform: scale(1.2); animation: bounce 0.8s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        #timer { font-size: 3.5rem; color: #ffeb3b; font-weight: bold; margin-bottom: 10px; text-shadow: 0 0 15px #f44336; font-family: 'Courier New', monospace; }
        .status-bar { border-bottom: 2px solid var(--main-pink); margin-bottom: 15px; padding-bottom: 5px; font-size: 0.8rem; display: flex; justify-content: space-between; color: var(--main-pink); font-weight: bold; }
        #question-box { min-height: 110px; margin-bottom: 20px; font-size: 1.05rem; line-height: 1.6; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 20px; border: 2px dashed var(--main-pink); display: flex; align-items: center; justify-content: center; text-align: left; }
        
        input { width: 85%; background: rgba(0,0,0,0.5); border: 3px solid var(--main-pink); border-radius: 20px; color: #fff; font-size: 1.8rem; text-align: center; outline: none; padding: 10px; }
        
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(20,0,0,0.98); display: flex; align-items: center; justify-content: center; z-index: 100; }
        #briefing { width: 85%; max-width: 450px; padding: 35px; border: 8px double var(--main-pink); background: #2b0000; border-radius: 50px; text-align: center; }
        .rule-list { text-align: left; font-size: 0.9rem; line-height: 1.8; margin: 20px 0; color: #ffccd5; border-left: 5px solid var(--main-pink); padding-left: 15px; }
        
        .hidden { display: none !important; }
        button { background: linear-gradient(to bottom, #ff4d94, #ff0055); color:#fff; border:none; padding:18px; font-weight:bold; cursor:pointer; font-size: 1.2rem; width: 100%; border-radius: 50px; box-shadow: 0 5px 0 #a00; outline: none; }
        button:active { transform: translateY(5px); box-shadow: none; }
        .flash-wrong { animation: shake 0.2s; background: #800 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(10px); } 75% { transform: translateX(-10px); } }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="briefing">
            <h2 style="color: var(--main-pink); margin-top: 0; text-shadow: 0 0 10px var(--main-pink);">ğŸ’ NYANKO GATE ğŸ’</h2>
            <div class="rule-list">
                ãƒ»å…¨ <span style="color:var(--gold); font-weight:bold;">10é–€</span> ã®å£ã‚’çªç ´ã›ã‚ˆï¼<br>
                ãƒ»é€šå¸¸ã‚¨ãƒªã‚¢ï¼š3å•ã”ã¨ã« <span style="color:var(--gold); font-weight:bold;">90ç§’</span>ã€‚<br>
                ãƒ»æœ€çµ‚ã‚¨ãƒªã‚¢ï¼šç©¶æ¥µã®è«–ç†ãƒ‘ã‚ºãƒ« <span style="color:var(--gold); font-weight:bold;">90ç§’</span>ã€‚<br>
                ãƒ»<span style="color:#ff4d94; font-weight:bold;">æœ€çµ‚å•é¡Œã¯ã€Œ1å›ãƒŸã‚¹ã€ã§å³çµ‚äº†ã€‚</span>
            </div>
            <button onclick="pressStart()">æŒ‘æˆ¦ã‚’é–‹å§‹ã™ã‚‹ğŸ¾</button>
        </div>
    </div>

    <div id="terminal">
        <div id="progress-bar">
            <div class="step" id="s1">ğŸ¾</div><div class="step" id="s2">ğŸ¾</div><div class="step" id="s3">ğŸ¾</div>
            <div class="step" id="s4">ğŸ¾</div><div class="step" id="s5">ğŸ¾</div><div class="step" id="s6">ğŸ¾</div>
            <div class="step" id="s7">ğŸ¾</div><div class="step" id="s8">ğŸ¾</div><div class="step" id="s9">ğŸ¾</div>
            <div class="step" id="s10">ğŸ¾</div>
        </div>
        <div class="status-bar">
            <span>AREA: <span id="q-num">1</span>/10</span>
            <span id="system-mode">VALENTINE SECURITY</span>
        </div>
        <div id="timer">01:30</div>
        <div id="main-content">
            <div id="question-box">READY...</div>
            <input type="text" id="code-input" autocomplete="off" placeholder="ç­”ãˆï¼" onkeydown="handleEnter(event)">
        </div>
        <div id="rest-content" class="hidden">
            <h2 id="rest-title" style="color: #ffd700;">â˜• SAFE AREA â˜•</h2>
            <p id="rest-text">æ™‚é–“ã¯æ­¢ã¾ã£ã¦ã„ã¾ã™ã€‚æ·±å‘¼å¸ã—ã¦ã€‚</p>
            <button id="next-btn" onclick="nextQuestion()">æ¬¡ã®ã‚¨ãƒªã‚¢ã¸</button>
        </div>
        <div id="msg" style="margin-top:20px; text-align:center; color:var(--gold); font-weight:bold; font-size: 0.85rem;">[Enter] èªè¨¼</div>
    </div>

<script>
    let audioCtx;
const QUESTIONS = [
        { q: "å¤ä»£ã‚¨ã‚¸ãƒ—ãƒˆã§ã€ã€Œãƒã€ã§ã¯ã˜ã¾ã‚‹çŒ«ã®é ­ã‚’æŒã¤å§¿ã§æã‹ã‚ŒãŸè±Šç©£ã®å¥³ç¥ã®åå‰ã¯ï¼Ÿ", a: "ãƒã‚¹ãƒ†ãƒˆ" },
        { q: "ã€Œé»’çŒ«ã€ã€Œä¸‰æ¯›çŒ«ã€ã€Œç™½çŒ«ã€ã®ã†ã¡ã€éºä¼å­¦çš„ã«ãã®ã»ã¨ã‚“ã©ï¼ˆ99%ä»¥ä¸Šï¼‰ãŒãƒ¡ã‚¹ãªã®ã¯ï¼Ÿ", a: "ä¸‰æ¯›çŒ«" },
        { q: "è‹±èªã§ã€ŒçŒ«ã€ã¯ã‚­ãƒ£ãƒƒãƒˆã€‚ã§ã¯ã€Œå­çŒ«ã€ã‚’æŒ‡ã™æ„›ç§°ã¯ï¼Ÿ", a: "ã‚­ãƒ†ã‚£" },
        { q: "ã€è¨ˆç®—ã€‘3ã¤ã‚ã‚‹ãŠè“å­ã‚’5å€ã«ã—ã¦ã‹ã‚‰7ã¤é£Ÿã¹ã‚‹ã¨ã€æ®‹ã‚Šã¯ã„ãã¤ï¼Ÿ", a: "8" },
        { q: "çŒ«ã®è¶³ã®è£ã«ã‚ã‚‹ã€ã·ã«ã·ã«ã¨ã—ãŸæŸ”ã‚‰ã‹ã„éƒ¨åˆ†ã¯ï¼Ÿ", a: "è‚‰çƒ" },
        { q: "ã€æš—å·ã€‘ã«ã‚ƒã‚“ã“ã®å¥½ç‰©ã§ã€åå‰ã«ã€Œã¡ã€ã¨ã€Œã‚‹ã€ãŒã¤ããŠã‚„ã¤ã¯ï¼Ÿ", a: "ã¡ã‚…ãƒ¼ã‚‹" },
        { q: "ä¸­ä¸–æ¬§å·ã§çŒ«ãŒè¿«å®³ã•ã‚ŒãŸçµæœã€ãƒã‚ºãƒŸãŒåª’ä»‹ã—ã¦å¤§æµè¡Œã—ãŸç—…æ°—ã¯ï¼Ÿ", a: "ãƒšã‚¹ãƒˆ" },
        { q: "é»’çŒ«ã€ä¸‰æ¯›çŒ«ã¯å½çŒ«ã€ ä¸‰æ¯›çŒ«ã€ç™½çŒ«ã¯çœŸçŒ«ã€ ç™½çŒ«ã€é»’çŒ«ã¨ç§ã¯åŒç¨®ã€ çœŸå®Ÿã‚’è¨€ã†çœŸçŒ«ã¯ã©ã®çŒ«ï¼Ÿ", a: "é»’çŒ«" },
        { q: "çŒ«ã®ç›®ã¯æš—é—‡ã§å…‰ã‚Šã¾ã™ãŒã€ãã®ç¶²è†œè£ã«ã‚ã‚‹åå°„å±¤ã®åå‰ã¯ï¼Ÿ (4æ–‡å­—)", a: "ã‚¿ãƒšã‚¿ãƒ " },
        { q: "ã€æœ€çµ‚ãƒ»è«–ç†ã€‘Aã€œDã•ã‚“ã«ã€Œã‚¯ãƒƒã‚­ãƒ¼ã€ãƒã‚«ãƒ­ãƒ³ã€ã©ã‚‰ç„¼ãã€ãƒãƒ¼ã‚ºã‚±ãƒ¼ã‚­ã€ã‚’ 1ã¤ãšã¤é…ã£ãŸã€‚\nâ‘ Aã¯æ´‹è“å­ã ãŒç„¼ãè“å­ã§ã¯ãªã„\nâ‘¡Bã¯å’Œè“å­ã§ã¯ãªã„\nâ‘¢Cã¯ã—ã£ã¨ã‚Šç³»\nâ‘£Dã¯å€‹åŒ…è£…ã®ã‚µã‚¯ã‚µã‚¯ç³»\nâ‘¤ã‚¯ãƒƒã‚­ãƒ¼ã¯Aã§ã‚‚Cã§ã‚‚ãªã„\nAã•ã‚“ãŒã‚‚ã‚‰ã£ãŸã®ã¯ï¼Ÿ", a: "ãƒãƒ¼ã‚ºã‚±ãƒ¼ã‚­" }
    ];

    let currentIdx = 0;
    let timeLeft = 90.0;
    let gameActive = false;
    let timerInterval;

    function pressStart() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('overlay').classList.add('hidden');
        gameActive = true;
        loadQuestion();
        startTimer();
    }

    function playSound(f, t, d, v = 0.1) {
        if(!audioCtx) return;
        try {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = t; o.frequency.value = f; g.connect(audioCtx.destination);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + d);
            o.connect(g); o.start(); o.stop(audioCtx.currentTime + d);
        } catch(e) {}
    }

    function playFinalGateSound() {
        const notes = [523.25, 659.25, 783.99, 1046.50];
        notes.forEach((f, i) => {
            setTimeout(() => playSound(f, 'sine', 0.5, 0.1), i * 120);
        });
    }

    function startTimer() {
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if(!gameActive) return;
            timeLeft -= 0.1;
            if (timeLeft <= 0) { timeLeft = 0; updateTimerDisplay(); gameOver(false); }
            updateTimerDisplay();
        }, 100);
    }

    function updateTimerDisplay() {
        const m = Math.max(0, Math.floor(timeLeft / 60)); 
        const s = Math.max(0, Math.floor(timeLeft % 60));
        document.getElementById('timer').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        if(timeLeft < 10 && timeLeft > 0 && Math.floor(timeLeft*10)%2===0) playSound(1000, 'square', 0.05, 0.02);
    }

    function updateProgress() {
        for(let i=1; i<=10; i++) {
            const el = document.getElementById('s' + i);
            el.classList.remove('active', 'current');
            if(i <= currentIdx) el.classList.add('active');
            if(i === currentIdx + 1) el.classList.add('current');
        }
    }

    function loadQuestion() {
        updateProgress();
        const q = QUESTIONS[currentIdx];
        const msgArea = document.getElementById('msg');
        const inputArea = document.getElementById('code-input');
        
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('rest-content').classList.add('hidden');
        
        if (currentIdx === 9) {
            document.getElementById('terminal').classList.add('final-warning-mode');
            document.getElementById('system-mode').innerText = "FATAL SECURITY: ONE CHANCE";
            msgArea.innerText = "âš ï¸ è­¦å‘Šï¼šèª¤å…¥åŠ›ã¯å³åº§ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’ç‰©ç†ç ´å£Šã—ã¾ã™";
            msgArea.style.color = "#ff0000";
            inputArea.placeholder = "ç­”ãˆã‚’æ…é‡ã«â€¦";
        } else {
            msgArea.innerText = "[Enter] èªè¨¼ã«ã‚ƒï¼";
            msgArea.style.color = "var(--gold)";
            inputArea.placeholder = "ç­”ãˆã‚’å…¥åŠ›ï¼";
        }

        document.getElementById('q-num').innerText = currentIdx + 1;
        document.getElementById('question-box').innerText = q.q;
        inputArea.value = "";
        setTimeout(() => inputArea.focus(), 10);
    }

    function handleEnter(e) { if (e.key === 'Enter') checkAnswer(); }

    function checkAnswer() {
        if(!gameActive) return;
        
        let val = document.getElementById('code-input').value.trim();
        val = val.replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));

        const correct = QUESTIONS[currentIdx].a;

        if (val === correct) {
            if (currentIdx === 8) {
                playFinalGateSound();
            } else {
                playSound(880, 'sine', 0.1, 0.1);
            }
            currentIdx++;
            if (currentIdx >= 10) { updateProgress(); gameOver(true); }
            else if (currentIdx % 3 === 0) showSafeRoom();
            else loadQuestion();
        } else {
            if (currentIdx === 9) {
                gameActive = false; clearInterval(timerInterval);
                playSound(100, 'sawtooth', 1.2, 0.3);
                document.getElementById('terminal').style.borderColor = "red";
                document.getElementById('msg').innerHTML = "<span style='color:red;'>è‡´å‘½çš„ãªèªè¨¼ã‚¨ãƒ©ãƒ¼ã€‚ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å‰¥å¥ªã€‚</span>";
                setTimeout(() => location.href = "top.html", 1500);
                return;
            }
            document.getElementById('terminal').classList.add('flash-wrong');
            playSound(150, 'sawtooth', 0.2, 0.1);
            setTimeout(() => document.getElementById('terminal').classList.remove('flash-wrong'), 300);
        }
    }

    function showSafeRoom() {
        gameActive = false; clearInterval(timerInterval); updateProgress();
        const restTitle = document.getElementById('rest-title');
        const restText = document.getElementById('rest-text');
        const nextBtn = document.getElementById('next-btn');
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('rest-content').classList.remove('hidden');
        
        if (currentIdx === 9) {
            restTitle.innerText = "âš ï¸ ULTIMATE GATE âš ï¸"; restTitle.style.color = "#f00";
            restText.innerHTML = "æ¬¡ã¯ã„ã‚ˆã„ã‚ˆæœ€çµ‚å•é¡Œã€‚ãƒŸã‚¹ã¯è¨±ã•ã‚Œãªã„...<br>è«–ç†ã®è¿·å®®ã‚’è§£ãæ˜ã‹ã›ã€‚<br>æ™‚é–“ã¯<span style='font-size:1.5rem; color:#f00;'>ã€ 90ç§’ ã€‘</span>ã ã«ã‚ƒï¼";
            nextBtn.innerText = "æœ€çµ‚æ±ºæˆ¦ã‚’ã¯ã˜ã‚ã‚‹"; nextBtn.style.background = "#f00";
            timeLeft = 90.0;
        } else {
            timeLeft = 90.0;
            playSound(1200, 'sine', 0.4, 0.05);
        }
    }

    function nextQuestion() { gameActive = true; loadQuestion(); startTimer(); }

    function gameOver(isWin) {
        gameActive = false; clearInterval(timerInterval);
        if (isWin) {
            document.getElementById('msg').innerText = "æ„›ã®å‹åˆ©ã«ã‚ƒï¼è»¢é€ã™ã‚‹ã‚ˆğŸ’";
            setTimeout(() => window.location.href = "mystery_game_clear.html", 2000);
        } else {
            document.getElementById('msg').innerText = "æ™‚é–“åˆ‡ã‚Œã«ã‚ƒ... ãƒãƒ§ã‚³ãŒæº¶ã‘ãŸã«ã‚ƒã€‚";
            setTimeout(() => window.location.href = "top.html", 2000);
        }
    }
</script>
</body>
</html>